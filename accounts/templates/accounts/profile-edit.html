{% extends 'base.html' %}

{% block title %}Edit Profile{% endblock title %}

{% block content %}

	<div class="container mt-3">
		<div class="row">
			<div class="col-lg-6 offset-lg-3">
				<div class="card p-3">
					<h4 class="text-center mb-3">Edit Profile</h4>
					<form method="post" enctype="multipart/form-data">
						{% csrf_token %}
						<div>
					        <label class="font-weight-bold">Profile Picture</label>
					        <div class="d-flex justify-content-center">
						        <div class="rounded-circle position-relative" style="width: 150px; height: 150px;">
						        	<img src="{{ user.userprofile.get_profileimage }}">
						        	<label class="position-absolute bg-danger text-white rounded p-1 c-pointer" style="top: 70%; left: 80%; z-index: 2;">
						        		<i class="fa fa-pen"></i>
						        		<!-- <span>Update Image</span> -->
						        		<input type="file" class="d-none img-input" name="profile_image">
						        	</label>
						        	<div class="position-absolute w-100 h-100 rounded-circle img-preview" style="top: 0; left: 0;"></div>
						        </div>
					        </div>
				        </div>

				        <div class="mt-3">
					        <label class="font-weight-bold">Cover Picture</label>
					        <div class="d-flex justify-content-center">
						        <div class="rounded position-relative" style="width: 150px; height: 150px;">
						        	<img src="{{ user.userprofile.get_coverimage }}">
						        	<label class="position-absolute bg-danger text-white rounded p-1 c-pointer" style="top: 70%; left: 80%; z-index: 2;">
						        		<i class="fa fa-pen"></i>
						        		<!-- <span>Update Image</span> -->
						        		<input type="file" class="d-none img-input" name="cover_image">
						        	</label>
						        	<div class="position-absolute w-100 h-100 rounded img-preview" style="top: 0; left: 0;"></div>
						        </div>
					        </div>
				        </div>

				        <div class="form-group">
				        	<label class="font-weight-bold">First Name</label>
				        	<input type="text" name="first_name" class="form-control {% if user_form.first_name.errors %}is-invalid{% endif %}" aria-describedby="id_first_name_feedback" value="{% if user_form.first_name.value %}{{ user_form.first_name.value }}{% endif %}">
				        	{% if user_form.first_name.errors %}
				        		<div class="invalid-feedback d-flex flex-column">
				        			{% for error in user_form.first_name.errors %}
				        				<span>{{ error }}</span>
				        			{% endfor %}
				        		</div>
				        	{% endif %}
				        </div>
				        <div class="form-group">
				        	<label class="font-weight-bold">Last Name</label>
				        	<input type="text" name="last_name" class="form-control {% if user_form.last_name.errors %}is-invalid{% endif %}" aria-describedby="id_last_name_feedback" value="{% if user_form.last_name.value %}{{ user_form.last_name.value }}{% endif %}">
				        	{% if user_form.last_name.errors %}
				        		<div class="invalid-feedback d-flex flex-column">
				        			{% for error in user_form.last_name.errors %}
				        				<span>{{ error }}</span>
				        			{% endfor %}
				        		</div>
				        	{% endif %}
				        </div>
				        <div class="form-group">
				        	<label class="font-weight-bold">Other Name</label>
				        	<input type="text" name="other_name" class="form-control {% if profile_form.other_name.errors %}is-invalid{% endif %}" aria-describedby="id_other_name_feedback" value="{% if profile_form.other_name.value %}{{ profile_form.other_name.value }}{% endif %}">
				        	{% if profile_form.other_name.errors %}
				        		<div class="invalid-feedback d-flex flex-column">
				        			{% for error in profile_form.other_name.errors %}
				        				<span>{{ error }}</span>
				        			{% endfor %}
				        		</div>
				        	{% endif %}
				        </div>
				        <div class="form-group">
				        	<label class="font-weight-bold">Email</label>
				        	<input type="text" name="email" class="form-control {% if user_form.email.errors %}is-invalid{% endif %}" aria-describedby="id_email_feedback" value="{% if user_form.email.value %}{{ user_form.email.value }}{% endif %}">
				        	{% if user_form.email.errors %}
				        		<div class="invalid-feedback d-flex flex-column">
				        			{% for error in user_form.email.errors %}
				        				<span>{{ error }}</span>
				        			{% endfor %}
				        		</div>
				        	{% endif %}
				        </div>
				        <div class="form-group">
				        	<label class="font-weight-bold">Username</label>
				        	<input type="text" name="username" class="form-control {% if user_form.username.errors %}is-invalid{% endif %}" aria-describedby="id_username_feedback" value="{% if user_form.username.value %}{{ user_form.username.value }}{% endif %}">
				        	{% if user_form.username.errors %}
				        		<div class="invalid-feedback d-flex flex-column">
				        			{% for error in user_form.username.errors %}
				        				<span>{{ error }}</span>
				        			{% endfor %}
				        		</div>
				        	{% endif %}
				        </div>
				        <div class="form-group">
				        	<label class="font-weight-bold">Phone</label>
				        	<input type="text" name="phone" class="form-control {% if profile_form.phone.errors %}is-invalid{% endif %}" aria-describedby="id_phone_feedback" value="{% if profile_form.phone.value %}{{ profile_form.phone.value }}{% endif %}">
				        	{% if profile_form.phone.errors %}
				        		<div class="invalid-feedback d-flex flex-column">
				        			{% for error in profile_form.phone.errors %}
				        				<span>{{ error }}</span>
				        			{% endfor %}
				        		</div>
				        	{% endif %}
				        </div>
				        <div class="form-group">
				        	<label class="font-weight-bold">Date Of Birth</label>
				        	<input type="date" name="birth_date" class="form-control {% if profile_form.birth_date.errors %}is-invalid{% endif %}" aria-describedby="id_birth_date_feedback" value="{% if profile_form.birth_date.value %}{{ profile_form.birth_date.value }}{% endif %}">
				        	{% if profile_form.birth_date.errors %}
				        		<div class="invalid-feedback d-flex flex-column">
				        			{% for error in profile_form.birth_date.errors %}
				        				<span>{{ error }}</span>
				        			{% endfor %}
				        		</div>
				        	{% endif %}
				        </div>
				        <div class="form-group">
				        	<label class="font-weight-bold">Location</label>
				        	<input type="text" name="location" class="form-control {% if profile_form.location.errors %}is-invalid{% endif %}" aria-describedby="id_location_feedback" value="{% if profile_form.location.value %}{{ profile_form.location.value }}{% endif %}">
				        	{% if profile_form.location.errors %}
				        		<div class="invalid-feedback d-flex flex-column">
				        			{% for error in profile_form.location.errors %}
				        				<span>{{ error }}</span>
				        			{% endfor %}
				        		</div>
				        	{% endif %}
				        </div>
				        <div class="form-group">
				        	<label class="font-weight-bold">Occupation</label>
				        	<input type="text" name="occupation" class="form-control {% if profile_form.occupation.errors %}is-invalid{% endif %}" aria-describedby="id_occupation_feedback" value="{% if profile_form.occupation.value %}{{ profile_form.occupation.value }}{% endif %}">
				        	{% if profile_form.occupation.errors %}
				        		<div class="invalid-feedback d-flex flex-column">
				        			{% for error in profile_form.occupation.errors %}
				        				<span>{{ error }}</span>
				        			{% endfor %}
				        		</div>
				        	{% endif %}
				        </div>
				        <div class="form-group">
				        	<label class="font-weight-bold">Martial Status</label>
				        	<input type="text" name="marital_status" class="form-control {% if profile_form.marital_status.errors %}is-invalid{% endif %}" aria-describedby="id_marital_status_feedback" value="{% if profile_form.marital_status.value %}{{ profile_form.marital_status.value }}{% endif %}">
				        	{% if profile_form.marital_status.errors %}
				        		<div class="invalid-feedback d-flex flex-column">
				        			{% for error in profile_form.marital_status.errors %}
				        				<span>{{ error }}</span>
				        			{% endfor %}
				        		</div>
				        	{% endif %}
				        </div>
				        <div class="form-group">
				        	<label class="font-weight-bold">Overview</label>
				        	<textarea name="overview" class="form-control {% if profile_form.overview.errors %}is-invalid{% endif %}" aria-describedby="id_overview_feedback">{% if profile_form.overview.value %}{{ profile_form.overview.value }}{% endif %}</textarea>
				        	{% if profile_form.overview.errors %}
				        		<div class="invalid-feedback d-flex flex-column">
				        			{% for error in profile_form.overview.errors %}
				        				<span>{{ error }}</span>
				        			{% endfor %}
				        		</div>
				        	{% endif %}
				        </div>
				        <button type="submit" class="btn btn-primary ml-auto d-block">Update Profile</button>
					</form>
				</div>
			</div>
		</div>
	</div>

{% endblock content %}

{% block js %}
	<script>
		const imgInput = document.querySelectorAll('.img-input');
		let imagesArray = [];

		imgInput.forEach(function(input, i) {
			input.addEventListener('change', function() {
				const file = this.files;
				imagesArray = [];
				for (let key in file) {
					imagesArray.push(file[key]);
				};
				imagesArray.splice(imagesArray.length - 2, 2);
				displayUploadedImgs(this, i);
			});
		});

		function displayUploadedImgs(input, i) {
			let images = '';
			imagesArray.forEach(function(image, index) {
				images += `<img src="${URL.createObjectURL(image)}" alt="image">`;
				images += `<a href="javascript:void()" onclick="clearImgs(${i})" class="btn btn-sm btn-danger position-absolute rounded-pill" style="top: -5%; left: 80%;">Undo</i></a>`;
			});
			input.parentElement.parentElement.querySelector('.img-preview').innerHTML = images;
		};

		function clearImgs(index) {
			imgInput[index].value = null;
			imagesArray = [];
			displayUploadedImgs(imgInput[index], index);
		};
	</script>
{% endblock js %}